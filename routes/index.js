var express = require('express');var router = express.Router();var multer = require('multer');var storage = multer.memoryStorage();var upload = multer({ storage: storage });router.get('/', (req,res)=>res.render('index',{title:'Home',data:req.session.data||{}}));router.post('/personal', upload.single('photo'), (req,res)=>{req.session.data = req.session.data || {};req.session.data.personal = req.body || {};if(req.file){var base64 = req.file.buffer.toString('base64');req.session.data.personal.photo = 'data:' + req.file.mimetype + ';base64,' + base64;}res.redirect('/skills');});router.get('/skills', (req,res)=>res.render('skills',{title:'Skills & Education',data:req.session.data||{}}));router.post('/skills', (req,res)=>{req.session.data = req.session.data || {};var skills_text = req.body.skills_text || '';var checks = req.body.skills_check || [];if(!Array.isArray(checks) && checks) checks = [checks];req.session.data.skills = { text: skills_text, checks: checks };var edu_levels = req.body.edu_level || [];var edu_insts = req.body.edu_institution || [];var edu_boards = req.body.edu_board || [];var edu_years = req.body.edu_year || [];var edu_perc = req.body.edu_percentage || [];function norm(x){ if(!x) return []; return Array.isArray(x)?x:[x]; }edu_levels = norm(edu_levels);edu_insts = norm(edu_insts);edu_boards = norm(edu_boards);edu_years = norm(edu_years);edu_perc = norm(edu_perc);var education = [];for(var i=0;i<edu_levels.length;i++){education.push({level: edu_levels[i]||'',institution: edu_insts[i]||'',board: edu_boards[i]||'',year: edu_years[i]||'',percentage: edu_perc[i]||''});}req.session.data.education = education;res.redirect('/projects');});router.get('/projects', (req,res)=>res.render('projects',{title:'Projects',data:req.session.data||{}}));router.post('/projects', upload.array('project_files', 20), (req,res)=>{req.session.data = req.session.data || {};var descs = req.body.project_desc || [];function norm(x){ if(!x) return []; return Array.isArray(x)?x:[x]; }descs = norm(descs);var files = [];for(var i=0;i<(req.files||[]).length;i++){var f = req.files[i];var base64 = f.buffer.toString('base64');files.push({ originalname: f.originalname, data: 'data:'+f.mimetype+';base64,'+base64, desc: descs[i]||'' });}req.session.data.projects = files;res.redirect('/contact');});router.get('/contact', (req,res)=>res.render('contact',{title:'Contact',data:req.session.data||{}}));router.post('/contact', (req,res)=>{req.session.data = req.session.data || {};req.session.data.contact = req.body || {};res.redirect('/resume');});router.get('/resume', (req,res)=>res.render('resume',{title:'Resume',data:req.session.data||{}}));router.post('/finish', (req,res)=>{req.session.destroy(()=>{res.redirect('/thankyou');});});router.get('/thankyou', (req,res)=>res.render('thankyou',{title:'Thank you'}));module.exports = router;
